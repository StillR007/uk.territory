const getUserUrl="/rest/requests/getUserRequest.ajax.php",licId=document.querySelector("#lic-id").innerText,main=document.querySelector(".appeals-container");let data={licId:licId};function convertDateToReadable(e){return new Date(e).toLocaleString("ru-RU",{day:"2-digit",month:"long",year:"numeric"})}function appealGetStatus(e){switch(e){case"NEW":return"red";case"1":return"blue";case"WON":case"LOSE":return"gray"}}function getRatingStars(e){let t=document.createElement("div");t.className="stars";for(let a=0;a<e;a++)t.insertAdjacentHTML("afterbegin",'<svg class="checked" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 19"><path d="M9.8 15l-5.76 3.09 1.1-6.545L.48 6.91l6.44-.955L9.8 0l2.88 5.955 6.44.955-4.66 4.635 1.1 6.545z"></path></svg>');if(5===e)return t;for(let a=0;a<5-e;a++)t.insertAdjacentHTML("beforeend",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 19"><path d="M9.8 15l-5.76 3.09 1.1-6.545L.48 6.91l6.44-.955L9.8 0l2.88 5.955 6.44.955-4.66 4.635 1.1 6.545z"></path></svg>');return t}function clearResults(){statusButtonText.innerText="Статус",dateTo.setAttribute("value",""),dateTo.innerText="",dateTo.removeAttribute("min"),dateFrom.setAttribute("value",""),dateFrom.innerText="",dateFrom.removeAttribute("max"),dateInnerText.innerText="Период",appealSearchBtnText.innerText="Поиск",appealSearch.setAttribute("value",""),data={licId:licId}}function noAppealResult(){totalAppeals.innerText="0"}function showDeleteIcon(){if(!document.querySelector("#appeals-delete")){let e=document.createElement("button");e.className="appeals-buttons__button appeals-buttons__button--text",e.id="appeals-delete",e.innerHTML='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" class="cache-0"><path d="M20 5a1 1 0 010 2h-.269l-1.784 13.267a2 2 0 01-1.825 1.727l-.157.006h-7.93a1.998 1.998 0 01-1.982-1.733L4.269 7H4a1 1 0 010-2h16zm-2.287 2H6.287l1.748 13h7.93l1.748-13zM12 9a1 1 0 011 1v7a1 1 0 01-2 0v-7a1 1 0 011-1zm2-7a1 1 0 010 2h-4a1 1 0 010-2h4z"></path></svg>',document.querySelector(".appeals-buttons").append(e),e.addEventListener("click",()=>{clearResults(),appealsAjax(data),e.remove()})}}const appealSelect=document.querySelector("#appeal-select");function getAppeals(e){if(document.querySelector(".appeals-main.active")){[...document.querySelectorAll(".appeals-main.active")].forEach(e=>e.remove())}if(e.code&&"200"==e.code&&e.data.items.length>0){totalAppeals.innerText=e.data.total;e.data.items.forEach(e=>{const t=document.createElement("a");t.className="appeals-main active",t.href=`/appeals2/${e.ID}/`;const a=document.createElement("div");a.className="appeals-main__column-1";const n=document.createElement("div");n.className="appeals-main__column-2";const l=document.createElement("div");l.className="appeals-main__column-3";const s=document.createElement("div");s.className="appeals-main__column-4";const c=document.createElement("div");c.className="appeals-main__column-5",a.insertAdjacentHTML("afterbegin",`<p class="appeals-main__number">${e.ID}</p>`),a.insertAdjacentHTML("beforeend",`<time datetime="${e.DATE_CREATE}">${convertDateToReadable(e.DATE_CREATE)}</time>`),n.insertAdjacentHTML("afterbegin",`<p>${e.SUBJECT}</p>`),l.insertAdjacentHTML("afterbegin",`<p>${e.PRICE}</p>`),s.insertAdjacentHTML("afterbegin",`<p><span class="appeals-status-circle ${appealGetStatus(e.STAGE)}"></span>${e.STATUS}</p>`),s.insertAdjacentHTML("beforeend",`<time datetime="${e.DATE_UPDATE}">${convertDateToReadable(e.DATE_UPDATE)}</time>`),"WON"===e.STAGE&&(0!==e.RATING?c.append(getRatingStars(e.RATING)):c.insertAdjacentHTML("afterbegin",'<button class="btn btn-territory btn-round-left post-comment">Оценить услугу</button>')),t.append(a),t.append(n),t.append(l),t.append(s),t.append(c),main.append(t)})}else noAppealResult()}const totalAppeals=document.querySelector(".appeals-count>span");function appealsAjax(e){$.ajax({type:"POST",url:getUserUrl,data:e,success:function(e){getAppeals(e)},error:function(e){console.log(e),noAppealResult()}})}appealsAjax(data);