const allBtnsNode=document.querySelectorAll(".btn.btn-territory.btn-round-left"),allBtns=[...allBtnsNode],licId=document.querySelector("#lic-id").innerText,popup=document.querySelector("#meters-popup"),ipuType=document.querySelector("#ipu-type"),ipuNum=document.querySelector("#ipu-num"),ipuZone=document.querySelector("#ipu-zone"),ipuDate=document.querySelector("#ipu-date"),input=document.querySelector("#ipu-meter"),errorField=document.querySelector("#error-field"),sendBtn=document.querySelector("#meter-send"),sendMeterUrl="/include/api/meters/addReadingsIpuForLic.ajax.php";function insertPopupValues(e,t,n,u,i){ipuType.setAttribute("value",""+e),ipuNum.setAttribute("value",""+t),ipuZone.setAttribute("value",""+i),ipuDate.setAttribute("value",""+n),input.setAttribute("placeholder","min: "+u),input.setAttribute("min",""+u)}function inputCheck(){return input.value?Number(input.value)<Number(input.getAttribute("min"))?(errorField.textContent="Значение ниже допустимого",input.style.border="1px solid red",sendBtn.setAttribute("disabled","disabled"),!1):(input.style.border="1px solid #dde3e8",errorField.textContent="",sendBtn.removeAttribute("disabled"),!0):(errorField.textContent="Введите значение счётчика",input.style.border="1px solid red",sendBtn.setAttribute("disabled","disabled"),!1)}function showPopup(e,t){popup.classList.add("active"),input.value="",input.innerText="",input.addEventListener("input",inputCheck),input.addEventListener("focus",inputCheck),input.addEventListener("blur",inputCheck),input.addEventListener("keydown",inputCheck),input.addEventListener("keyup",inputCheck)}let date=new Date,yyyy=date.getFullYear(),mm=date.getMonth()+1,dd=date.getDate();dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm);let today=dd+"."+mm+"."+yyyy;function closePopup(){popup.classList.remove("active"),document.querySelector("body").classList.remove("lock"),input.style.border="1px solid #dde3e8",errorField.textContent="",input.value="",sendBtn.setAttribute("disabled","disabled")}function showResultPopup(e){document.querySelector("body").classList.add("lock");let t=document.createElement("div");t.id="result-popup",t.className="active";let n=document.createElement("popup"),u=document.createElement("button");u.className="btn btn-territory btn-round-right spec-btn-secr";let i=document.createElement("p");"ok"===e?(i.innerText="Данные успешно отправлены!",u.innerText="Хорошо"):(i.innerText="Данные не отправлены!",u.innerText="Жаль("),n.append(i),n.append(u),t.append(n),document.querySelector("body").append(t),u.addEventListener("click",(function(){location.reload()}))}allBtns.forEach((e,t)=>{e.removeAttribute("disabled"),e.addEventListener("click",(function(){document.querySelector("body").classList.add("lock");this.closest(".meters");let e=this.getAttribute("data-min"),n=this.getAttribute("data-zone"),u=this.getAttribute("data-name"),i=this.closest(".meters__right-column").querySelector(".meters__name").innerText.replace("Счётчик ","");insertPopupValues(u,String(i),today,e,n),showPopup(this,t)}))}),document.querySelector("#close-form").addEventListener("click",(function(){closePopup()})),sendBtn.addEventListener("click",()=>{BX.showWait(),$.ajax({type:"POST",url:sendMeterUrl,data:{licId:""+licId,data:""+input.value,ipuName:""+ipuType.value,ipuNum:""+ipuNum.value,ipuZone:""+ipuZone.value,ipuDate:""+ipuDate.value},success:function(e){e.code&&"200"==e.code?(closePopup(),showResultPopup("ok")):(console.log(data),closePopup(),showResultPopup())},error:function(e){console.log(e),closePopup(),showResultPopup()},complete:function(){BX.closeWait()}})});